#!/bin/bash
#script to look for presence of file in /tmp/ generated by a udev rule. This then causes tuned-adm to apply a certain profile

#if this be first boot, first check the AC status manually
pmtoggle

## Polling is expensive. Let us use inotify.
inotifywait --monitor --format "%e %w%f" --event modify,create /tmp/pmtoggle | while read changed; do
    ## If the tmp file has value 0, that means that there is no AC attached
    if [ ! -z "$(tail -n2 /tmp/pmtoggle | grep '0')" ]; then
        tuned-adm profile powersave #tuned's powersave profile
        echo "AC not attached. Entering powersave mode..."

    ## Else, if the tmp file has value 1, that means there is AC attached
    else
        tuned-adm profile throughput-performance #tuned's throughput-performance profile
        echo "AC attached. Entering performance mode..."
    fi
done
